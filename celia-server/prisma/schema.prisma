generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String   @id @default(uuid())
  email              String   @unique
  password           String
  fullName           String   @map("full_name")
  collegeName        String?  @map("college_name")
  major              String?
  graduationYear     Int?     @map("graduation_year")
  bio                String   @default("")
  avatarUrl          String?  @map("avatar_url")
  photoUrls          Json     @default("[]") @map("photo_urls")
  interests          String[] @default([])
  collegeVerified    Boolean  @default(false) @map("college_verified")
  preferredLocations String[] @default([]) @map("preferred_locations")
  profileCompleted   Boolean  @default(false) @map("profile_completed")
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")

  hostedEvents        Event[]            @relation("HostedEvents")
  sentInvitations     EventInvitation[]  @relation("SentInvitations")
  receivedInvitations EventInvitation[]  @relation("ReceivedInvitations")
  eventAttendances    EventAttendee[]

  @@index([email])
  @@index([collegeName])
  @@map("users")
}

model Event {
  id                 String    @id @default(uuid())
  hostId             String    @map("host_id")
  name               String
  description        String?
  categoryId         String?   @map("category_id")
  locationName       String?   @map("location_name")
  locationLat        Float?    @map("location_lat")
  locationLng        Float?    @map("location_lng")
  eventDate          DateTime? @map("event_date") @db.Date
  startTime          DateTime? @map("start_time")
  endTime            DateTime? @map("end_time")
  photoUrls          Json      @default("[]") @map("photo_urls")
  interestTags       String[]  @default([]) @map("interest_tags")
  capacityLimit      Int?      @map("capacity_limit")
  isPublic           Boolean   @default(true) @map("is_public")
  status             String    @default("draft")
  cancellationReason String?   @map("cancellation_reason")
  createdAt          DateTime  @default(now()) @map("created_at")
  updatedAt          DateTime  @updatedAt @map("updated_at")

  host        User              @relation("HostedEvents", fields: [hostId], references: [id], onDelete: Cascade)
  category    EventCategory?    @relation(fields: [categoryId], references: [id])
  invitations EventInvitation[]
  attendees   EventAttendee[]

  @@index([hostId])
  @@index([status])
  @@index([eventDate])
  @@index([categoryId])
  @@index([isPublic])
  @@map("events")
}

model EventCategory {
  id        String   @id @default(uuid())
  name      String   @unique
  icon      String?
  createdAt DateTime @default(now()) @map("created_at")

  events Event[]

  @@map("event_categories")
}

model EventInvitation {
  id              String   @id @default(uuid())
  eventId         String   @map("event_id")
  inviterId       String   @map("inviter_id")
  inviteeId       String   @map("invitee_id")
  status          String   @default("pending")
  personalMessage String?  @map("personal_message")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  event   Event @relation(fields: [eventId], references: [id], onDelete: Cascade)
  inviter User  @relation("SentInvitations", fields: [inviterId], references: [id], onDelete: Cascade)
  invitee User  @relation("ReceivedInvitations", fields: [inviteeId], references: [id], onDelete: Cascade)

  @@unique([eventId, inviteeId])
  @@index([inviteeId])
  @@index([inviterId])
  @@index([eventId])
  @@index([status])
  @@map("event_invitations")
}

model EventAttendee {
  id       String   @id @default(uuid())
  eventId  String   @map("event_id")
  userId   String   @map("user_id")
  joinedAt DateTime @default(now()) @map("joined_at")

  event Event @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([eventId, userId])
  @@index([eventId])
  @@index([userId])
  @@map("event_attendees")
}

model InterestCategory {
  id        String   @id @default(uuid())
  name      String   @unique
  createdAt DateTime @default(now()) @map("created_at")

  @@map("interest_categories")
}

model College {
  id        String   @id @default(uuid())
  name      String   @unique
  domain    String?
  location  String?
  createdAt DateTime @default(now()) @map("created_at")

  @@map("colleges")
}
